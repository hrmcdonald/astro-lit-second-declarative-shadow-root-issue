import{c as k,a as O,s as A,o as T,f as P,b as D,h as I,d as R,e as f}from"./floating-ui.dom.ZqocShws.js";import{M as F,d as L}from"./icon.dbwUGlQ4.js";import{i as U,D as _,S as z,c as $,j as B,F as H,C as S,P as K,k as M,h as N,a as j,g as b,_ as t,n as i,r as n,e as h,l as y,o as a,d as X}from"./chunk.BDXXLFJI.Wz8REFjk.js";import{x as q}from"./directive.qvJfFQ74.js";import{o as v}from"./query-assigned-elements.QVyvENXT.js";import{e as l}from"./class-map.iK5X3Dze.js";import{a as m}from"./anime.es.OMgaynFP.js";var W=U`:host{--padding-y:12px;--padding-x:var(--mte-space-comfy-md);--radius:var(--mte-border-radius-md);--background:var(--mte-surface-2);--border-color:var(--mte-border-2)}:host{display:block;pointer-events:none;position:absolute;z-index:1000}:host ::slotted(mte-content),:host ::slotted(mte-footer),:host ::slotted(mte-header){--composition-padding-y:0px;--composition-padding-x:0px}.trigger-container{display:inline-block}.popover-container{display:none;position:fixed;z-index:var(--mte-z-index-20)}.popover-container.visible{border-radius:var(--radius);box-shadow:var(--mte-elevation-z1)}.popover{font-family:var(--mte-font-family-sans);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;background:var(--background);border:1px solid var(--border-color);border-radius:var(--radius);display:flex;font-size:var(--mte-font-set-caption-font-size);font-weight:var(--mte-font-set-caption-font-weight);line-height:var(--mte-font-set-caption-line-height);overflow:hidden;pointer-events:auto;position:relative;text-decoration:inherit;text-overflow:ellipsis;text-transform:inherit}.content{display:flex;flex-direction:column;padding:var(--padding-y) var(--padding-x) var(--padding-y) var(--padding-x);z-index:2}#header{align-items:center;display:flex}#header.has-content{padding-bottom:var(--padding-y)}slot[name=header]{font-family:var(--mte-font-family-sans);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:block;flex-direction:row;flex-grow:1;font-size:var(--mte-font-set-body2-font-size);font-weight:var(--mte-font-set-body2-font-weight);font-weight:var(--mte-font-weight-bold);line-height:var(--mte-font-set-body2-line-height);text-decoration:inherit;text-transform:inherit}:host ::slotted(mte-title){font-family:var(--mte-font-family-sans);-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-size:var(--mte-font-set-body2-font-size);font-weight:var(--mte-font-set-body2-font-weight);font-weight:var(--mte-font-weight-bold);line-height:var(--mte-font-set-body2-line-height);text-decoration:inherit;text-transform:inherit}#body{display:block;flex-grow:1}#footer.has-content{padding-top:var(--padding-y)}.arrow{background:var(--background);display:none;height:8px;opacity:0;position:absolute;transform:rotate(45deg);width:8px;z-index:1}.arrow.top,.arrow.top-end,.arrow.top-start{border-bottom:1px solid var(--border-color);border-right:1px solid var(--border-color)}.arrow.right,.arrow.right-end,.arrow.right-start{border-bottom:1px solid var(--border-color);border-left:1px solid var(--border-color)}.arrow.bottom,.arrow.bottom-end,.arrow.bottom-start{border-left:1px solid var(--border-color);border-top:1px solid var(--border-color)}.arrow.left,.arrow.left-end,.arrow.left-start{border-right:1px solid var(--border-color);border-top:1px solid var(--border-color)}.arrow.visible{display:block;opacity:1}`;F.registerIcons([L]);var J=0,g=0,e=class extends _(z(b)){constructor(){super(),this.id=`mte-popover--${J++}`,this.position="top",this.placement="center",this.openDelay=0,this.closeDelay=0,this.offset=8,this.withoutArrow=!1,this.withoutFocusTrap=!1,this.withoutCloseOnClickOutside=!1,this.withoutCloseOnEscape=!1,this.withoutPortal=!1,this.ariaHidden="true",this.ariaLive="off",this.role="dialog",this.isFocusFallback=!0,this.tabindex="-1",this.triggerOn="click",this.animationDuration=$.animation.transitionDurationJs.short*1e3,this.portalAdapter=B,this.visible=!1,this.opened=!1,this.renderedPosition=null,this.cleanupUpdateListeners=null,this.focusTrapController=new H(this),this.clickOutsideController=new S(this,()=>{this.withoutPortal&&this.handleCloseOnClickOutside()}),this.portalController=new K(this),this.detectChildCloseController=new M(this),this.slotController=new N(this,{updateOnChange:["default","header","footer"]}),this.hasHeader=!1,this.hasFooter=!1,this.updatePosition=()=>{if(this.targetElement){const[o,s]=k(this.position,this.placement);O(this.targetElement,this.popoverContainerElem,{placement:o,strategy:"fixed",middleware:[A({padding:16}),T(this.offset),P({fallbackPlacements:s}),D({element:this.arrowElem}),I()].filter(r=>r!==null)}).then(({x:r,y:w,placement:d,middlewareData:p})=>{this.renderedPosition=d;const{referenceHidden:C}=p.hide;Object.assign(this.popoverContainerElem.style,{left:`${r}px`,top:`${w}px`,visibility:C?"hidden":"visible"});const{x:c,y:u,centerOffset:E}=p.arrow,x={top:"bottom",right:"left",bottom:"top",left:"right"}[d.split("-")[0]];E!==0?this.arrowElem.style.opacity="0":Object.assign(this.arrowElem.style,{left:c!=null?`${c}px`:"",top:u!=null?`${u}px`:"",right:"",bottom:"",opacity:1,[x]:"-4px"})})}},this.handleCloseOnClickOutside=()=>{this.opened&&!this.withoutCloseOnClickOutside&&this.close()},this.open=this.open.bind(this),this.close=this.close.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}get headerElementRef(){return this._headerElementRef}set headerElementRef(o){if(this._headerElementRef=o,o){const r=this._headerElementRef?.getAttribute("id")??`${this.id}-${g++}`;this._headerElementRef?.setAttribute("id",r),this.ariaLabelledBy=r}else this.ariaLabelledBy=null}get contentElementRef(){return this._contentElementRef}set contentElementRef(o){if(this._contentElementRef=o,o){const r=this._contentElementRef?.getAttribute("id")??`${this.id}-${g++}`;this._contentElementRef?.setAttribute("id",r),this.ariaDescribedBy=r}else this.ariaDescribedBy=null}handleTriggerOnChange(){this.role=this.triggerOn==="click"||this.triggerOn==="none"?"dialog":"tooltip",this.isFocusFallback=this.role==="dialog",this._onTriggerChange.emit(this.triggerOn),this.updateTriggerAriaIds()}handleIdChange(){this.updateTriggerAriaIds()}handleDisabledChange(){this.visible&&this.close()}handleWithoutCloseOnEscape(){!this.withoutCloseOnEscape&&this.visible?document.addEventListener("keydown",this.handleKeyDown):this.visible&&document.removeEventListener("keydown",this.handleKeyDown)}handlePositionChange(){this.updatePosition(),this.renderedPosition=null}handleTargetChange(){this.updateTriggerAriaIds(),this.updatePosition()}firstUpdated(){this.opened||(this.ariaHidden="true"),this.updateTriggerAriaIds()}connectedCallback(){super.connectedCallback(),this.slotController.watchSlots(["default","header","footer"]).subscribe(o=>{o?.has("header")&&(this.hasHeader=this.slotController.check("header"),this.headerElements?.length>0&&(this.headerElementRef=this.headerElements?.[0])),o?.has("footer")&&(this.hasFooter=this.slotController.check("footer")),o?.has("default")&&this.contentElements?.length>0&&(this.contentElementRef=this.contentElements?.[0])})}disconnectedCallback(){super.disconnectedCallback(),this.cleanupUpdateListeners?.(),this.cleanupUpdateListeners=null,this.openAnimationRef?.remove(),this.closeAnimationRef?.remove(),document.removeEventListener("keydown",this.handleKeyDown)}toggle(){return this.visible?this.close():this.open()}open(){return new Promise(o=>{!this.disabled&&!this.visible&&this.targetElement&&(this.closeTimeoutId&&(clearTimeout(this.closeTimeoutId),this.closeTimeoutId=null),this.openTimeoutId=setTimeout(()=>{(this.withoutPortal?Promise.resolve():this.portalController.appendToStack(this,{withInertBackdrop:this.triggerOn!=="click"||this.withoutCloseOnClickOutside&&this.withoutFocusTrap,portalAdapter:this.portalAdapter,closeOnClickOutsideHandler:this.handleCloseOnClickOutside})).then(()=>{this.cleanupUpdateListeners||setTimeout(()=>{this.cleanupUpdateListeners=R(this.targetElement,this.popoverContainerElem,this.updatePosition)}),this.opened||this._onOpen.emit(null,{bubbles:!1}),this.opened=!0,this.ariaHidden="false",this.ariaLive=this.triggerOn==="click"||this.triggerOn==="none"?"off":"polite",this.targetElement?.setAttribute("aria-expanded","true"),this.openTimeoutId=null,this.popoverContainerElem?(this.popoverContainerElem.style.display="block",this.closeAnimationRef?.pause(),this.openAnimationRef?.remove(),this.openAnimationRef=m({targets:this.popoverContainerElem,...f(this.renderedPosition,{fallbackPosition:this.position,fallbackPlacement:this.placement,action:"open",scaleX:.9}),opacity:{value:[0,1],easing:"linear",duration:this.animationDuration/2},easing:"easeOutElastic(.5, .75)",duration:this.animationDuration,complete:()=>{o()}})):o()})},this.openDelay))}).then(()=>{this.visible=!0,this.openAnimationRef?.remove(),this.openAnimationRef=null,this.clickOutsideController.listenForClicksOutsideOf(this.popoverContainerElem),this.withoutCloseOnEscape||document.addEventListener("keydown",this.handleKeyDown),this.triggerOn==="click"&&!this.withoutFocusTrap&&setTimeout(()=>{this.updateComplete.then(()=>{this.focusTrapController.trapFocus(this,document.activeElement)})},50)})}close(){return new Promise(o=>{this.openTimeoutId&&(clearTimeout(this.openTimeoutId),this.openTimeoutId=null),this.closeTimeoutId=setTimeout(()=>{this.opened&&this._onClose.emit(null,{bubbles:!1}),this.opened=!1,this.ariaHidden="true",this.ariaLive="off",this.targetElement?.setAttribute("aria-expanded","false"),this.closeTimeoutId=null,this.cleanupUpdateListeners?.(),this.cleanupUpdateListeners=null,this.popoverContainerElem?(this.openAnimationRef?.pause(),this.closeAnimationRef?.remove(),this.closeAnimationRef=m({targets:this.popoverContainerElem,...f(this.renderedPosition,{fallbackPosition:this.position,fallbackPlacement:this.placement,action:"close",scaleX:.9}),opacity:{value:[1,0],easing:"linear",duration:this.animationDuration/2},easing:"easeOutElastic(.5, .75)",duration:this.animationDuration,complete:()=>{o()}})):o()},this.closeDelay)}).then(()=>{this.visible=!1,this.popoverContainerElem.style.display="",this.closeAnimationRef?.remove(),this.closeAnimationRef=null,this.portalController.removeFromStack(),this.clickOutsideController.stopListening(),this.withoutCloseOnEscape||document.removeEventListener("keydown",this.handleKeyDown),this.withoutFocusTrap||this.focusTrapController.releaseFocus(!0)})}handleKeyDown(o){o.key==="Escape"&&this.close()}updateTriggerAriaIds(){this.targetElement&&(this.triggerOn==="click"?(this.targetElement.removeAttribute("aria-describedby"),this.targetElement.setAttribute("aria-haspopup","true"),this.targetElement.setAttribute("aria-controls",this.id)):(this.targetElement.setAttribute("aria-describedby",this.id),this.targetElement.removeAttribute("aria-haspopup"),this.targetElement.removeAttribute("aria-controls"))),this.opened&&(this.ariaLive=this.triggerOn==="click"||this.triggerOn==="none"?"off":"polite")}render(){const o=l({visible:this.visible}),s=l({visible:!this.withoutArrow,[this.renderedPosition]:!0});return q`${this.instanceStyles}<div class="popover-container ${o}"><div class="popover"><div class="content" part="content"><div id="header" part="header" class="${l({"has-content":this.hasHeader})}"><slot name="header"></slot></div><span id="body" part="body"><slot></slot></span><div id="footer" part="footer" class="${l({"has-content":this.hasFooter})}"><slot name="footer"></slot></div></div></div><div part="arrow" class="arrow ${s}"></div></div>`}};e.styles=[j,W];e.shadowRootOptions={...b.shadowRootOptions,delegatesFocus:!1};t([i({reflect:!0})],e.prototype,"id",2);t([i({reflect:!0})],e.prototype,"position",2);t([i({reflect:!0})],e.prototype,"placement",2);t([i({type:Number,reflect:!0})],e.prototype,"openDelay",2);t([i({type:Number,reflect:!0})],e.prototype,"closeDelay",2);t([i({type:Number,reflect:!0})],e.prototype,"offset",2);t([i({type:Boolean,reflect:!0})],e.prototype,"withoutArrow",2);t([i({type:Boolean,reflect:!0})],e.prototype,"withoutFocusTrap",2);t([i({type:Boolean,reflect:!0})],e.prototype,"withoutCloseOnClickOutside",2);t([i({type:Boolean,reflect:!0})],e.prototype,"withoutCloseOnEscape",2);t([i({type:Boolean,reflect:!0})],e.prototype,"withoutPortal",2);t([i({attribute:"aria-hidden",reflect:!0})],e.prototype,"ariaHidden",2);t([i({attribute:"aria-live",reflect:!0})],e.prototype,"ariaLive",2);t([i({attribute:"aria-labelledby",reflect:!0})],e.prototype,"ariaLabelledBy",2);t([i({attribute:"aria-describedby",reflect:!0})],e.prototype,"ariaDescribedBy",2);t([i({reflect:!0})],e.prototype,"role",2);t([i({attribute:"data-focus-fallback",type:Boolean,reflect:!0})],e.prototype,"isFocusFallback",2);t([i({reflect:!0})],e.prototype,"tabindex",2);t([i({reflect:!0})],e.prototype,"triggerOn",2);t([i({attribute:!1})],e.prototype,"targetElement",2);t([i({type:Number})],e.prototype,"animationDuration",2);t([i()],e.prototype,"portalAdapter",2);t([n()],e.prototype,"visible",2);t([n()],e.prototype,"opened",2);t([n()],e.prototype,"renderedPosition",2);t([h()],e.prototype,"_onTriggerChange",2);t([h()],e.prototype,"_onOpen",2);t([h()],e.prototype,"_onClose",2);t([v({slot:"header"})],e.prototype,"headerElements",2);t([v()],e.prototype,"contentElements",2);t([y(".popover-container")],e.prototype,"popoverContainerElem",2);t([y(".arrow")],e.prototype,"arrowElem",2);t([n()],e.prototype,"hasHeader",2);t([n()],e.prototype,"hasFooter",2);t([a("triggerOn")],e.prototype,"handleTriggerOnChange",1);t([a("id",{waitUntilFirstUpdate:!0})],e.prototype,"handleIdChange",1);t([a("disabled",{waitUntilFirstUpdate:!0})],e.prototype,"handleDisabledChange",1);t([a("withoutCloseOnEscape")],e.prototype,"handleWithoutCloseOnEscape",1);t([a(["position","placement","se","sp","offset"],{waitUntilFirstUpdate:!0})],e.prototype,"handlePositionChange",1);t([a(["targetElement"],{waitUntilFirstUpdate:!0})],e.prototype,"handleTargetChange",1);e=t([X("mte-popover")],e);export{e as MtePopover};
