import{c as M,a as I,s as A,o as P,f as N,h as D,d as L,e as m}from"./floating-ui.dom.ZqocShws.js";import{M as R,e as S,f as _}from"./icon.dbwUGlQ4.js";import{i as g,D as T,S as v,c as U,j as $,P as F,R as H,C as B,h as z,s as K,a as y,_ as t,n as a,p as b,r as h,e as l,l as x,o as d,d as C,q as G,B as j,t as q,g as w}from"./chunk.BDXXLFJI.Wz8REFjk.js";import{e as p}from"./class-map.iK5X3Dze.js";import{x as u}from"./directive.qvJfFQ74.js";import{o as c}from"./query-assigned-elements.QVyvENXT.js";import{a as f}from"./anime.es.OMgaynFP.js";var W=g`:host{--z-index:var(--mte-z-index-20);--color:var(--mte-ink-1);--background:var(--mte-surface-2);--border-color:var(--mte-border-2);--radius:var(--mte-border-radius-md);--padding-y:var(--mte-space-xs);--padding-x:var(--mte-space-xs);--header-padding-y:calc(var(--padding-y) + var(--mte-space-xs) + var(--mte-space-xxs));--header-padding-x:calc(var(--padding-x) + var(--mte-space-sm) + var(--mte-space-xs));--gap:var(--mte-space-xs);--box-shadow:var(--mte-elevation-z1);pointer-events:auto}:host{display:block;pointer-events:none;position:absolute;z-index:1000}.menu{background:var(--background);border:1px solid var(--border-color);border-radius:var(--radius);box-shadow:var(--box-shadow);color:var(--color);display:none;flex-direction:column;gap:var(--gap);outline:none;overflow:hidden;overflow-y:auto;padding:var(--padding-y) var(--padding-x);pointer-events:auto;position:fixed;z-index:var(--z-index)}.header{border-bottom:2px solid var(--mte-border-1);display:none;margin:calc(var(--padding-y)*-1) calc(var(--padding-x)*-1) 0 calc(var(--padding-x)*-1);padding:var(--header-padding-y) var(--header-padding-x)}.header.has-content{display:initial}::slotted(mte-divider),mte-divider{margin:0 calc(var(--padding-x)*-1);width:calc(100% + var(--padding-x) + var(--padding-x))}`,X=0,Y=0,i=class extends T(v(w)){constructor(){super(),this.id=`mte-menu--${X++}`,this.position="bottom",this.placement="start",this.triggerOn="click",this.withoutCloseOnClickOutside=!1,this.withoutCloseOnEscape=!1,this.withoutPortal=!1,this.ariaHidden="true",this.role="menu",this.isNestedMenu=!1,this.animationDuration=U.animation.transitionDurationJs.short*1e3,this.offset=2,this.portalAdapter=$,this.opened=!1,this.visible=!1,this.renderedPosition=null,this.hasHeader=!1,this.preventNextFocusRestoration=!1,this.cleanupUpdateListeners=null,this.portalController=new F(this),this.restoreFocusController=new H(this),this.clickOutsideController=new B(this,()=>{this.withoutPortal&&this.handleCloseOnClickOutside()}),this.slotController=new z(this,{updateOnChange:["header"]}),this.updatePosition=()=>{if(this.targetElement){const[e,s]=M(this.position,this.placement);I(this.targetElement,this.menuElem,{strategy:"fixed",placement:e,middleware:[A({padding:this.offset}),P(this.offset),N({fallbackPlacements:s}),D()].filter(n=>n!==null)}).then(({x:n,y:r,placement:E,middlewareData:k})=>{this.renderedPosition=E;const{referenceHidden:O}=k.hide;Object.assign(this.menuElem.style,{left:`${n}px`,top:`${r}px`,visibility:O?"hidden":"visible"})})}},this.handleNestedMenuOpened=e=>{this.menuItemElems?.forEach(s=>{s!==e.target&&s?.closeChild()}),this.clickOutsideController.addTarget(e.detail),this._proxyNestedMenuOpened.emit(e.detail),e.stopPropagation()},this.handleMenuItemClicked=e=>{this._onSelect.emit({nativeEvent:e.detail,selected:e.detail.target,value:e.detail.target?.value}),this.close(),e.stopPropagation()},this.handleCloseOnClickOutside=()=>{this.opened&&!this.withoutCloseOnClickOutside&&this.close()},this.open=this.open.bind(this),this.close=this.close.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleGlobalKeyDown=this.handleGlobalKeyDown.bind(this),this.handleMenuItemClicked=this.handleMenuItemClicked.bind(this)}get headerElementRef(){return this._headerElementRef}set headerElementRef(e){if(this._headerElementRef=e,e){const n=this._headerElementRef?.getAttribute("id")??`${this.id}-${Y++}`;this._headerElementRef?.setAttribute("id",n),this.ariaLabelledBy=n}else this.ariaLabelledBy=null}handleTriggerOnChange(){this._onTriggerChange.emit(this.triggerOn),this.updateTargetAriaIds()}handleA11yChange(){this.updateTargetAriaIds()}handleTargetChange(){this.updatePosition()}handleDisabledChange(){this.visible&&this.close()}handleWithoutCloseOnEscape(){!this.withoutCloseOnEscape&&this.visible?document.addEventListener("keydown",this.handleGlobalKeyDown):this.visible&&document.removeEventListener("keydown",this.handleGlobalKeyDown)}handlePositionChange(){this.updatePosition(),this.renderedPosition=null}firstUpdated(){this.opened||(this.ariaHidden="true"),this.updateTargetAriaIds()}connectedCallback(){super.connectedCallback(),this.addEventListener("menuItemClicked",this.handleMenuItemClicked),this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("mousedown",this.handleMouseDown),this.slotController.watchSlots(["header","default"]).subscribe(e=>{e?.has("header")&&(this.hasHeader=this.slotController.check("header"),this.headerElems?.length>0&&(this.headerElementRef=this.headerElems?.[0])),!this.__firstUpdated&&e?.has("default")&&this.setCurrentItem(this.getCurrentItem())})}disconnectedCallback(){super.disconnectedCallback(),this.cleanupUpdateListeners?.(),this.cleanupUpdateListeners=null,this.openAnimationRef?.remove(),this.closeAnimationRef?.remove(),document.removeEventListener("keydown",this.handleGlobalKeyDown)}toggle(){return this.visible?this.close():this.open()}open(){return new Promise(e=>{!this.disabled&&!this.visible&&this.targetElement&&(this.withoutPortal?Promise.resolve():this.portalController.appendToStack(this,{portalAdapter:this.portalAdapter,withInertBackdrop:this.isNestedMenu,closeOnClickOutsideHandler:this.handleCloseOnClickOutside})).then(()=>{this.cleanupUpdateListeners||setTimeout(()=>{this.cleanupUpdateListeners=L(this.targetElement,this.menuElem,this.updatePosition)}),this.opened||this._onOpen.emit(),this.opened=!0,this.ariaHidden="false",this.targetElement?.setAttribute("aria-expanded","true"),this.menuElem?(this.menuElem.style.display="flex",this.closeAnimationRef?.pause(),this.openAnimationRef?.remove(),this.openAnimationRef=f({targets:this.menuElem,...m(this.renderedPosition,{fallbackPosition:this.position,fallbackPlacement:this.placement,action:"open",scaleX:.95,scaleY:.85}),opacity:{value:[0,1],easing:"linear",duration:this.animationDuration/2},easing:"easeOutElastic(.5, .75)",duration:this.animationDuration,complete:()=>{e()}})):e()})}).then(()=>{this.visible=!0,this.openAnimationRef?.remove(),this.openAnimationRef=null,this.restoreFocusController.setRestoreFocusTarget(),this.clickOutsideController.listenForClicksOutsideOf(this.menuElem),this.addEventListener("nestedMenuOpened",this.handleNestedMenuOpened),this.withoutCloseOnEscape||document.addEventListener("keydown",this.handleGlobalKeyDown),setTimeout(()=>{this.initSelection()},50)})}close(){return new Promise(e=>{this.opened&&this._onClose.emit(),this.opened=!1,this.ariaHidden="true",this.targetElement?.setAttribute("aria-expanded","false"),this.cleanupUpdateListeners?.(),this.cleanupUpdateListeners=null,this.menuElem?(this.openAnimationRef?.pause(),this.closeAnimationRef?.remove(),this.closeAnimationRef=f({targets:this.menuElem,...m(this.renderedPosition,{fallbackPosition:this.position,fallbackPlacement:this.placement,action:"close",scaleX:.95,scaleY:.85}),opacity:{value:[1,0],easing:"linear",duration:this.animationDuration/2},easing:"easeOutElastic(.5, .75)",duration:this.animationDuration,complete:()=>{e()}})):e()}).then(()=>{this.visible=!1,this.menuElem.style.display="",this.closeAnimationRef?.remove(),this.closeAnimationRef=null,this.portalController.removeFromStack(),this.clickOutsideController.stopListening(),this.removeEventListener("nestedMenuOpened",this.handleNestedMenuOpened),this.preventNextFocusRestoration?this.preventNextFocusRestoration=!1:this.restoreFocusController.restoreFocus(!0),this.withoutCloseOnEscape||document.removeEventListener("keydown",this.handleGlobalKeyDown)})}handleGlobalKeyDown(e){(e.key==="Escape"||e.key==="Tab")&&(e.key==="Tab"&&e.preventDefault(),this.isNestedMenu&&(this.preventNextFocusRestoration=!0),this.close())}handleKeyDown(e){if(["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Home","End"].includes(e.key)){const s=this.getAllItems(),n=this.getCurrentItem();let r=n?s.indexOf(n):0;n.hasNestedMenu&&e.key==="ArrowRight"&&n.openChild(),this.isNestedMenu&&e.key==="ArrowLeft"&&this.close(),s.length>0&&(e.preventDefault(),e.stopPropagation(),e.key==="ArrowDown"?r++:e.key==="ArrowUp"?r--:e.key==="Home"?r=0:e.key==="End"&&(r=s.length-1),r<0&&(r=s.length-1),r>s.length-1&&(r=0),this.setCurrentItem(s[r]),s[r].focus())}}handleMouseDown(e){const s=e.target;this.isMenuItem(s)&&this.setCurrentItem(s)}initSelection(){this.getAllItems().forEach((s,n)=>{s.disabled||(s.setAttribute("tabindex",n===0?"0":"-1"),s.setAttribute("data-active",n===0?"true":"false"),n===0&&s.focus())})}isMenuItem(e){return e.tagName?e.tagName?.toLowerCase()==="mte-menu-item"||e.tagName?.toLowerCase()==="mte-color-scheme-menu-item":!1}getAllItems(){return(this.menuItemElems??[]).filter(e=>!(e.inert||!this.isMenuItem(e)))}getCurrentItem(){return this.getAllItems().find(e=>e.getAttribute("data-active")==="true")}setCurrentItem(e){this.getAllItems().forEach(n=>{n.setAttribute("tabindex",n===e?"0":"-1"),n.setAttribute("data-active",n===e?"true":"false")})}updateTargetAriaIds(){this.targetElement&&(this.targetElement.setAttribute("aria-haspopup","menu"),this.targetElement.setAttribute("aria-controls",this.id),!this.ariaLabel&&!this.ariaLabelledBy&&!this.headerElementRef&&(this.ariaLabelledBy=this.targetElement.id))}handleHeaderSlotChange(){this.headerElems?.length>0&&(this.hasHeader=!0)}updateInstanceStyles(e){super.updateInstanceStyles(e),(e.has("maxh")||e.has("minw"))&&this.setInstanceStyle("menu",K(":host:host:host:host:host:host .menu"),{maxh:this.maxh,minw:this.minw})}render(){return u`${this.instanceStyles}<div part="menu" class="menu"><span class="header ${p({"has-content":this.hasHeader})}" part="header"><slot name="header" @slotchange="${this.handleHeaderSlotChange}"></slot></span><slot></slot></div>`}};i.styles=[y,W];t([a({reflect:!0})],i.prototype,"id",2);t([a({reflect:!0})],i.prototype,"position",2);t([a({reflect:!0})],i.prototype,"placement",2);t([a({reflect:!0})],i.prototype,"triggerOn",2);t([a({type:Boolean,reflect:!0})],i.prototype,"withoutCloseOnClickOutside",2);t([a({type:Boolean,reflect:!0})],i.prototype,"withoutCloseOnEscape",2);t([a({type:Boolean,reflect:!0})],i.prototype,"withoutPortal",2);t([a({attribute:"aria-hidden",reflect:!0})],i.prototype,"ariaHidden",2);t([a({attribute:"aria-labelledby",reflect:!0})],i.prototype,"ariaLabelledBy",2);t([a({reflect:!0})],i.prototype,"role",2);t([a({reflect:!0,converter:b})],i.prototype,"maxh",2);t([a({reflect:!0,converter:b})],i.prototype,"minw",2);t([a({type:Boolean})],i.prototype,"isNestedMenu",2);t([a({type:Number})],i.prototype,"animationDuration",2);t([a({type:Number})],i.prototype,"offset",2);t([a({type:Object})],i.prototype,"targetElement",2);t([a()],i.prototype,"portalAdapter",2);t([h()],i.prototype,"opened",2);t([h()],i.prototype,"visible",2);t([h()],i.prototype,"renderedPosition",2);t([h()],i.prototype,"hasHeader",2);t([l()],i.prototype,"_onSelect",2);t([l()],i.prototype,"_onOpen",2);t([l()],i.prototype,"_onClose",2);t([l()],i.prototype,"_onTriggerChange",2);t([l()],i.prototype,"_proxyNestedMenuOpened",2);t([l()],i.prototype,"_proxyNestedMenuGlobalClosed",2);t([x(".menu")],i.prototype,"menuElem",2);t([c({slot:"header"})],i.prototype,"headerElems",2);t([c({selector:":not(mte-menu) mte-menu-item, :not(mte-menu) mte-color-scheme-menu-item",flatten:!0})],i.prototype,"menuItemElems",2);t([d("triggerOn")],i.prototype,"handleTriggerOnChange",1);t([d(["id","targetElement"],{waitUntilFirstUpdate:!0})],i.prototype,"handleA11yChange",1);t([d(["targetElement"],{waitUntilFirstUpdate:!0})],i.prototype,"handleTargetChange",1);t([d("disabled",{waitUntilFirstUpdate:!0})],i.prototype,"handleDisabledChange",1);t([d("withoutCloseOnEscape")],i.prototype,"handleWithoutCloseOnEscape",1);t([d(["position","placement","sp","se"],{waitUntilFirstUpdate:!0})],i.prototype,"handlePositionChange",1);i=t([C("mte-menu")],i);var J=g`:host{--color:inherit;--radius:var(--mte-border-radius-md);--padding-y:calc(var(--mte-space-xs) + var(--mte-space-xxs));--padding-x:calc(var(--mte-space-sm) + var(--mte-space-xs));--gap:var(--mte-space-sm);align-items:center;background:var(--background);border-radius:var(--radius);color:var(--color);cursor:pointer;display:flex;gap:var(--gap);padding:var(--padding-y) var(--padding-x);position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none}:host(:focus-visible:not(.disabled):not([disabled]):not(:disabled)):before{border:2px solid rgb(var(--mte-focus-rgb));border-bottom-left-radius:var(--radius);border-bottom-right-radius:var(--radius);border-top-left-radius:var(--radius);border-top-right-radius:var(--radius);box-shadow:0 0 0 1px var(--mte-light);content:"";display:block;inset:-1px;pointer-events:none;position:absolute;z-index:9}:host(::-moz-focus-inner){border:0;padding:0}:host(:focus-visible),:host(:hover){--background:rgba(var(--mte-it-surface-2-hover-rgb),var(--mte-it-surface-2-hover-a))}:host(:active),:host([activestate]){--background:rgba(var(--mte-it-surface-2-active-rgb),var(--mte-it-surface-2-active-a))}:host([danger]){--color:rgb(var(--mte-status-danger-base-rgb))}:host([danger]:focus-visible),:host([danger]:hover){--background:rgb(var(--mte-status-danger-lighter-rgb));--color:rgb(var(--mte-status-danger-dark-rgb))}:host([danger]:active),:host([danger][activestate]){--color:rgb(var(--mte-status-danger-darker-rgb))}:host([disabled]),:host([disabled]) a{cursor:not-allowed!important;--color:var(--mte-disabled-3)!important;box-shadow:none!important;text-shadow:none!important}:host([disabled]) .prop-icon{--color:var(--mte-disabled-3)!important;--icon-color:var(--mte-disabled-3)!important}:host([disabled]:hover),:host([disabled][activestate]){--background:transparent!important}:host([danger]) .prop-icon{--color:var(--color);--icon-color:var(--color)}.label{display:flex;flex-direction:row;flex-grow:1}.nested-menu,.prefix,.suffix{align-items:center;display:none;flex-direction:row}.has-content{display:flex}.nested-menu,.nested-menu-trigger{display:none}.nested-menu.has-child{display:flex}.suffix.has-content,.suffix:not(.has-content)+.nested-menu.has-child{padding-left:var(--mte-space-sm)}`;R.registerIcons([S,_]);var o=class extends G(j(v(w))){constructor(){super(),this.danger=!1,this.withoutCloseOnClick=!1,this.withAltSubmenuIndicator=!1,this.role="menuitem",this.hasNestedMenu=!1,this.handleClick=this.handleClick.bind(this),this.handleNestedMenuOpen=this.handleNestedMenuOpen.bind(this),this.handleProxyMenuItemClicked=this.handleProxyMenuItemClicked.bind(this),this.handleProxyNestedMenuOpen=this.handleProxyNestedMenuOpen.bind(this)}openChild(){this.overlayTriggerElem?.open()}closeChild(){this.overlayTriggerElem?.close()}connectedCallback(){super.connectedCallback(),this.slotController.watchSlots(["child"]).subscribe(e=>{if(e?.has("child")&&this.childElems?.length>0&&this.overlayTriggerElem){const s=this.childElems[0];s?.tagName.toLowerCase()==="mte-menu"&&(this.hasNestedMenu=!0,s.isNestedMenu=!0,s.position==="bottom"&&(s.position="right"),s.offset=2,s.addEventListener("menuItemClicked",this.handleProxyMenuItemClicked),s.addEventListener("onOpen",this.handleNestedMenuOpen),s.addEventListener("proxyNestedMenuOpened",this.handleProxyNestedMenuOpen),this.overlayTriggerElem.triggerElement=this,this.overlayTriggerElem.overlayElement=s)}}),this.addEventListener("click",this.handleClick)}handleClick(e){!this.withoutCloseOnClick&&!this.hasNestedMenu&&this._menuItemClicked.emit(e)}handleProxyMenuItemClicked(e){this._menuItemClicked.emit(e.detail)}handleNestedMenuOpen(){this._nestedMenuOpened.emit(this.overlayTriggerElem.overlayElement)}handleProxyNestedMenuOpen(e){this._nestedMenuOpened.emit(e.detail)}render(){const e=this.hasSlot("prefix",this.icon),s=this.hasSlot("suffix",this.suffixIcon),n=this.hasSlot("child",this.hasNestedMenu),r=this.withAltSubmenuIndicator?"dots-horizontal":"menu-right";return this.renderButtonTemplate(u`${this.instanceStyles}<div class="prefix ${p({"has-content":e})}" part="prefix"><slot name="prefix">${this.icon?u`<mte-icon class="prop-icon" muted autosize name="${this.icon}"></mte-icon>`:null}</slot></div><div class="label" part="label"><slot></slot></div><div class="suffix ${p({"has-content":s})}" part="suffix"><slot name="suffix">${this.suffixIcon?u`<mte-icon class="prop-icon" muted autosize name="${this.suffixIcon}"></mte-icon>`:null}</slot></div><span class="nested-menu ${p({"has-child":n})}"><mte-icon muted autosize name="${r}"></mte-icon><span class="nested-menu-trigger"><mte-overlay-trigger id="overlay-trigger"></mte-overlay-trigger><slot name="child"></slot></span></span>`)}};o.styles=[y,q,J];t([a({reflect:!0})],o.prototype,"icon",2);t([a({reflect:!0})],o.prototype,"suffixIcon",2);t([a({type:Boolean,reflect:!0})],o.prototype,"danger",2);t([a({type:Boolean,reflect:!0})],o.prototype,"withoutCloseOnClick",2);t([a({reflect:!0})],o.prototype,"value",2);t([a({type:Boolean,reflect:!0})],o.prototype,"withAltSubmenuIndicator",2);t([a({reflect:!0})],o.prototype,"role",2);t([x("#overlay-trigger")],o.prototype,"overlayTriggerElem",2);t([c({slot:"child"})],o.prototype,"childElems",2);t([h()],o.prototype,"hasNestedMenu",2);t([l()],o.prototype,"_menuItemClicked",2);t([l()],o.prototype,"_nestedMenuOpened",2);o=t([C("mte-menu-item")],o);export{i as MteMenu,o as MteMenuItem};
